# Google Places Enricher

This tool makes it easy to get data from Google Places API from any geographical area. It also helps to enrich it with other categories of interest ‚Äì including from different systems (Yelp categories are available by default).

## üíª Prereqs:

To get started make sure you meet the following requirements:

* Python environment - Version 3.7.4+

## ‚öôÔ∏è Install:

To install `Google Places Enricher` you need to clone the following repository:

```
git clone git@github.com:FerGubert/google_places_enricher.git
```

Create the `.env` file with your Google Places API key, as indicated in the `.env.example`.

After that you need to install the environment:

```
pip install .
```

## üöÄ Run:

This tool provides three different tasks, the task you want to run must be informed as an argument when executing the main file. Below are the details of each task.

### Tasks

#### 1-Coordinates Calculation

This task generates a CSV file with the geographic coordinates of a rectangular area according to a predetermined step in meters.

First, it is necessary to set the variables described below in the file `config.py`:

* NORTHEAST_LAT, NORTHEAST_LON: indicates the extreme northeast of the area.
* SOUTHWEST_LAT, SOUTHWEST_LON: indicates the extreme southwest of the area.
* RADIUS: several coordinates will be created within a specified area. The RADIUS parameter indicates the reach range for each of those coordinates.

Then you must inform the argument that indicates this task when executing the file `main.py`:

```
python src/main.py --task coordinates
```

The calculated coordinates will be available in `data/output/lat_lon_calculated.csv`.

#### 2-Retrieve Google Places Data

This task performs requests to the Google places API according to the geographic coordinates defined in the input file and a predetermined radius. It retrieves places information according to the categories defined in the input file, outputting the results in a CSV file. 

First, it is necessary to set the variable RADIUS described below in the file `config.py`.

It is also necessary to provide in `data/input` a CSV file called `lat_lon.csv` with the geographic coordinates that will be used in the request ‚Äì note that the file generated by the task Coordinates Calculation could be used. 

If you want to enrich the data obtained from the Google Places API with more specific categories, a CSV file with the desired categories must be made available in the same input directory. The categories of the fourth hierarchical level of the Yelp base are already available in `/data/input/categories_request.csv`.

Then you must inform the argument that indicates this task when executing the file `main.py`:

```
python src/main.py --task request
```

The processed data will be available in `data/output/establishments.csv`.

#### 3-Matching Categories

This task explores the information in the branch of the category in the hierarchy where it is located ‚Äì if available. For instance, it creates Yelp sentences using the category hierarchical levels names; for Google Places it creates the establishment sentences using the Google categories and the enrichment categories. The records of establishments with their sentences are exported in a CSV file. Then, for each sentence of the establishment, it retrieves the Yelp sentence with the highest semantic textual similarity, making these matchings available with their respective scores in a CSV file.

To execute this flow, the `hierarchical_yelp_categories.csv` file is used, containing the 4 hierarchical levels of the Yelp categories, available in `data/input`. It is also necessary to have available in `data/output` the csv file with the establishments retrieved from the Google places API, without changing the column schema and the name `establishments.csv`. 

Then it is necessary to inform the argument that indicates this flow when executing the file `main.py`:

```
python src/main.py --task match
```

The data of the establishments with their sentences will be available in `data/output/establishments_sentences.csv` and the match of the sentences of the establishments with the Yelp sentences, as well as the score, will be available in `data/output/matching_category_sentences.csv`.

## ü§ù Members:

Who are committers:

<b>Fernanda R Gubert</b>
